# 技术规范要求

## JSON格式规范

### 基础语法要求

#### 字符编码
- **编码格式**：UTF-8
- **特殊字符**：正确转义引号、换行符
- **中文支持**：完整支持中文字符

#### 语法结构
```json
{
  "string_field": "字符串值",
  "array_field": ["数组", "元素"],
  "object_field": {
    "nested": "嵌套对象"
  },
  "number_field": 123,
  "boolean_field": true
}
```

#### 常见错误及避免
```json
// ❌ 错误示例
{
  scene_id: "scene_001",          // 缺少引号
  "action": "动作描述",            // 尾部多余逗号
  "characters": ["角色1", "角色2",]
}

// ✅ 正确示例
{
  "scene_id": "scene_001",
  "action": "动作描述",
  "characters": ["角色1", "角色2"]
}
```

### 数组格式规范

#### 标准JSON数组结构
```json
[
  {
    // 第一个镜头的start帧
  },
  {
    // 第一个镜头的end帧
  },
  {
    // 第二个镜头的start帧
  },
  {
    // 第二个镜头的end帧
  }
]
```

#### 嵌套数组处理
```json
{
  "characters": ["角色1", "角色2", "角色3"],
  "dialogues": [
    "第一句对白",
    "第二句对白"
  ]
}
```

## 字段规范定义

### 必填字段列表
```
scene_id         - 镜头编号 (string)
frame_type       - 帧类型 (string: "start"|"end")
place           - 地点描述 (string)
time            - 时间描述 (string)
characters      - 人物列表 (array<string>)
action          - 动作描述 (string)
emotion         - 情绪描述 (string)
dialogues       - 对白列表 (array<string>)
narration       - 旁白描述 (string)
camera          - 摄影参数 (object)
character_layout - 人物站位 (string)
background_pure  - 纯背景描述 (string)
```

### 字段类型约束

#### 字符串字段 (String Fields)
```json
{
  "scene_id": "scene_001",
  "frame_type": "start",
  "place": "具体地点描述",
  "time": "时间氛围描述",
  "action": "动作状态描述",
  "emotion": "情绪表达",
  "narration": "旁白内容",
  "character_layout": "人物站位描述",
  "background_pure": "纯背景环境描述"
}
```

#### 数组字段 (Array Fields)
```json
{
  "characters": ["角色1", "角色2"],
  "dialogues": ["对白1", "对白2"]
}
```

#### 对象字段 (Object Fields)
```json
{
  "camera": {
    "shot_type": "镜头类型",
    "angle": "拍摄角度",
    "movement": "摄像机运动",
    "focus": "焦点位置"
  }
}
```

### 枚举值规范

#### scene_id格式
```
"scene_001", "scene_002", "scene_003", ...
- 必须以"scene_"开头
- 后接三位数字编号
- 从001开始连续递增
```

#### frame_type枚举
```
"start" - 镜头开始帧
"end"   - 镜头结束帧
```

#### camera.shot_type枚举
```
"Wide Shot"              - 远景
"Full Shot"              - 全景
"Medium Shot"            - 中景
"Close-up"               - 特写
"Extreme Close-up"       - 大特写
"Over-the-Shoulder Shot" - 过肩镜头
```

#### camera.angle枚举
```
"Eye-level"   - 平视角度
"Low-angle"   - 仰角
"High-angle"  - 俯角
"3/4 view"    - 四分之三角度
```

#### camera.movement枚举
```
"Static"     - 静止
"Push in"    - 推进
"Pull back"  - 拉远
"Pan left"   - 向左摇摆
"Pan right"  - 向右摇摆
"Tilt up"    - 向上倾斜
"Tilt down"  - 向下倾斜
"Track"      - 跟踪
```

#### camera.focus枚举
```
"前景"      - 前景焦点
"中景"      - 中景焦点
"角色脸部"   - 角色脸部焦点
"手部动作"   - 手部动作焦点
"环境"      - 环境焦点
```

## 内容规范要求

### 文本长度限制
- **action描述**：10-50字符
- **emotion描述**：2-10字符
- **narration描述**：20-150字符
- **character_layout描述**：30-200字符
- **background_pure描述**：50-300字符

### 描述风格要求

#### action字段
```
✅ 正确示例：
"叶凡抬起右手，准备挥出"
"苏灵溪双腿一软，瘫坐地上"

❌ 错误示例：
"叶凡想要做什么"  (过于抽象)
"角色进行了复杂的动作序列" (过于模糊)
```

#### emotion字段
```
✅ 正确示例：
"紧张", "愤怒", "震撼", "困惑"

❌ 错误示例：
"复杂的情感状态", "心情复杂"
```

#### character_layout字段
```
✅ 正确示例：
"前景偏左是叶凡，盘膝而坐，面向镜头；中景偏右是苏灵溪，躺在地上，侧身朝向叶凡"

❌ 错误示例：
"两个人在场景中"
"角色们处于不同位置"
```

#### background_pure字段
```
✅ 正确示例：
"山洞深处的岩石空间，地面平整，洞壁粗糙有纹理，深处隐没在黑暗中，微弱光线从入口处透入"

❌ 错误示例：
"叶凡所在的山洞环境" (提到了人物)
"一个地方" (过于模糊)
```

### 逻辑一致性要求

#### 同镜头一致性
```json
// scene_001的start和end帧必须保持以下字段一致：
{
  "scene_id": "scene_001",     // 完全相同
  "place": "山洞入口处",        // 完全相同
  "time": "白日，洞内昏暗",     // 完全相同
  "camera": {...}             // 完全相同
}
```

#### 镜头间连贯性
```
- 空间变化必须设置新的scene_id
- 时间跨越必须设置新的scene_id
- 人物列表变化要符合剧情逻辑
- 情绪变化要自然合理
```

## 数据验证规则

### 基础验证
1. **JSON语法验证**：使用标准JSON解析器验证
2. **字段存在性验证**：检查所有必填字段
3. **数据类型验证**：确认字段类型正确
4. **枚举值验证**：检查枚举字段取值合法

### 逻辑验证
1. **scene_id连续性**：编号必须连续无跳跃
2. **start/end配对**：每个scene_id必须有且仅有两帧
3. **镜头数量**：总镜头数控制在5-12个
4. **空间时间一致性**：同镜头相关字段必须一致

### 内容验证
1. **对白来源验证**：dialogues内容必须来自输入
2. **字符长度验证**：各字段长度符合限制
3. **描述质量验证**：避免模糊抽象表达
4. **专业术语验证**：摄影术语使用正确

## 输出质量要求

### 完整性要求
- 所有必填字段完整填写
- 数组字段不为null，可为空数组[]
- 字符串字段不为空字符串""
- 对象字段包含所有必需子字段

### 准确性要求
- 场景描述忠实原文
- 对白严格来源于输入
- 摄影参数专业准确
- 情绪表达符合逻辑

### 可执行性要求
- 人物站位描述具体可操作
- 背景描述独立完整可用
- 动作描述清晰明确
- 摄影参数可实际执行

### 专业性要求
- 摄影术语使用规范
- 镜头设计符合电影语言
- 构图变化丰富合理
- 整体效果具有视觉冲击力

## 错误处理机制

### 常见错误类型
1. **语法错误**：JSON格式不正确
2. **类型错误**：字段数据类型不匹配
3. **缺失错误**：必填字段遗漏
4. **逻辑错误**：内容逻辑不一致
5. **规范错误**：不符合格式规范

### 错误修复指导
- **语法错误**：使用JSON格式化工具检查
- **类型错误**：确认字段类型定义
- **缺失错误**：补充遗漏字段
- **逻辑错误**：检查镜头间逻辑关系
- **规范错误**：对照技术规范修正

这套技术规范确保了分镜数据的标准化、可执行性和专业性，为影视制作流程提供了可靠的技术基础。